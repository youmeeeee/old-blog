<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>ES6 Promise | Youmekko</title><meta name="description" content="ES6 Promise - Youme Choi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Youmekko"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Youmekko" type="application/atom+xml">
</head><body><div class="wrap"><header><h1 class="branding"><a href="/" title="Youmekko">Youmekko</a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/youmekko" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about" target="_self">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ES6 Promise</h1><div class="post-info"><a></a>2019-04-11</div><div class="post-content"><p>참고</p>
<p><a href="https://poiemaweb.com/es6-promise" target="_blank" rel="noopener">https://poiemaweb.com/es6-promise</a>  (랄까 거의 보면서 옮겨씀…)</p>
<p><a href="https://joshua1988.github.io/web-development/javascript/promise-for-beginners/" target="_blank" rel="noopener">https://joshua1988.github.io/web-development/javascript/promise-for-beginners/</a></p>
<p>콜백 방식의 비동기 처리가 갖는 문제점 중에서 가장 심각한 것은… 에러처리가 곤란하다는 것이다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;<span class="keyword">throw</span> <span class="string">'Error!'</span>&#125;, <span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'에러를 캐치하지는 못한다'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 이유는? 비동기 처리 함수의 콜백 함수는 해당 이벤트(DOM이벤트, timer 함수의 tick 이벤트, Ajax의 onreadystatechange이벤트 )가 발생하면 이벤트 큐(Event queue)로 이동한 후 호출 스택이 비어졌을 때  호출 스택으로 이동되어 실행 된다… setTime 은 비동기 함수이므로 콜백 함수의 실행 완료를 기다리지 않고 즉시 종료 되어 호출 스택에서 제거된다. 이후 이벤트가 발생하면 setTimeout 함수의 콜백 함수는 이벤트 큐로 이동한 후 호출스택이 비어졌을 때 호출스택으로 이동되어 실행된다. 이 때 setTimeout 함수는 이미 호출 스택에서 제거된 상태이다. 이것은 setTimeout 함수의 콜백 함수를 호출한 것은 setTimeout 함수가 아니다 라는 것을 의미한다. setTimeout 함수의 콜백 함수 호출자(caller)가 setTimeout 함수라면 호출 스택에 setTimeout 함수가 존재해야 하기 때문이다… 예외는 호출자 방향으로 전파된다. 하지만 위 설명 처럼 setTimeout 함수의 콜백 함수를 호출한 것은 setTimeout이 아니기 때문에 콜백 함수내에서 발생시킨 에러는 catch 블록에서 catch되지 않고 프로세스는 종료된다. 이러한 문제를 극복하기 위해 프로미스가 제안되었다. Promise는 ES6에 정식 채택되어 IE를 제위한 대부분의 브라우저가 지원하고 있다.</p>
<h3 id="프로미스의-생성"><a href="#프로미스의-생성" class="headerlink" title="프로미스의 생성"></a>프로미스의 생성</h3><p>프로미스는 Promise 생성자 함수를 통해 인스턴스화 한다. Promise 생성자 함수는 비동기 작업을 수행 할 콜백함수를 인자로 전달 받는데 이 콜백함수는 resolve와 reject 함수를 인자로 받는다…</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resove,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//비동기 작업 수행</span></span><br><span class="line">    $.<span class="keyword">get</span>('url', (response)=&gt;&#123;</span><br><span class="line">      <span class="comment">/* 비동기 작업 수행 성공 */</span></span><br><span class="line">      <span class="keyword">if</span>(response)&#123;</span><br><span class="line">        resolve(response);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/* 비동기 작업 수행 실패 */</span></span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Request is failed!'</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getData().then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Promise는 pending / fulfilled / rejected / settled 이렇게 4개의 상태(state) 정보를 갖는다. 단어 뜻 그대로..</p>
<p><img src="/img/2019-04-11-javascript-promise-01.png" alt=""></p>
<p>Promise 생성자 함수가 인자로 받은 콜백 함수는 내부에서 비동기 처리 작업을 수행한다. 이 때 비동기 처리가 성공하면 콜백 함수의 인자로 전달 받은 resolve라는 함수를 호출한다. 실해하면 reject 함수를 호출한다.</p>
<h3 id="프로미스의-후속-처리-메소드"><a href="#프로미스의-후속-처리-메소드" class="headerlink" title="프로미스의 후속 처리 메소드"></a>프로미스의 후속 처리 메소드</h3><p>Promise로 구현된 비동기 함수는 Promise 객체를 리턴한다. Promise로 구현된 비동기 함수를 호출하는 측(Promise customer)에서는 Promise 객체의 후속처리 메소드를 통해 비동기 처리 결과 또는 에러 메세지를 전달받아 처리한다.. Promise 객체는 상태를 갖는다고 위에서 얘기했는데 이 상태에 따라 후속  처리 메소드를 체이닝 방식으로 호출한다. Promise의 후속 처리 메소드는 아래와 같다.</p>
<p><code>then</code></p>
<p>then 메소드는 두개의 콜백함수를 인자로 받는다.첫번째 콜백함수 시 성공시 호출되고 두 번째 함수는 실패 시 호출된다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span>(url).then((result)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result) <span class="comment">//resolve에 비동기 함수의 리턴값</span></span><br><span class="line">&#125;, (error)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(error) <span class="comment">//error</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p><code>catch</code></p>
<p>예외(비동기 처리에서 발생한 에러와 then 메소드에서 발생한 에러)가 발생하면 호출 된다.  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span>(url).then((result)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(error);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>catch메소드는 에외처리를 한다는 점에서 then메소드의 두번째 콜백 함수와 유사하지만 미묘한 차이가 있는데, then  메소드의 두번째 콜백 함수는 비동기  처리에서 발생한 에러(reject 함수가 호출된 상태)만을 캐치한다. 하지만 catch메소드는 비동기 처리에서 발생한 에러뿐 아니라 then 메소드 내부에서 발생한 에러도 캐치한다. 따라서 에러 처리는 catch 메소드를 사용하는 편이 보다 효율적이다.</p>
<h3 id="프로미스-체이닝"><a href="#프로미스-체이닝" class="headerlink" title="프로미스 체이닝"></a>프로미스 체이닝</h3><p>프로미스는 후속 처리 메소드를 체이닝(chainning) 해 여러개의 프로미스를 연결해 사용할 수 있다. 이로서 콜백 헬을 해결한다.</p>
<p>Promise 객체를 반환한 비동기 함수는 프로미스 후속 처리 메소드인 then이나 catch 메소드를 사용할 수 있다. 따라서 thenn 메소드가 Promise 객체를 반환하도록 하면… 여러개의 프로미스를 연결하여 사용할 수있다.(then메소드를 호출하고 나면 새로운 프로미스 객체가 리턴된다.)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    resolve(<span class="number">1</span>);</span><br><span class="line">  &#125;,<span class="number">2000</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.lot(result); <span class="comment">//1</span></span><br><span class="line">  <span class="keyword">return</span> result+<span class="number">10</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">//11</span></span><br><span class="line">  <span class="keyword">return</span> result+<span class="number">20</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">//31</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="실무에-있을-법한-프로미스-사례-흠…"><a href="#실무에-있을-법한-프로미스-사례-흠…" class="headerlink" title="실무에 있을 법한 프로미스 사례 (흠…)"></a>실무에 있을 법한 프로미스 사례 (흠…)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getData(userInfo)</span><br><span class="line">  .then(parseValue)</span><br><span class="line">	.then(auth)</span><br><span class="line">	.then(display)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userInfo = &#123;</span><br><span class="line">  id: <span class="string">'youmekko'</span>,</span><br><span class="line">  pw: <span class="string">'pw1234'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseValue</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>













</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2019/04/11/2019-04-11-ES6-async-await/">prev</a><a class="next" href="/2019/04/11/2019-04-11-Javascript-callstack/">next</a></div><div class="copyright"><p>&copy; 2016 - 2020 <a href="https://www.example.org/john-doe" target="_blank" rel="noopener">John Doe</a>.<br>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/Dreyer/hexo-theme-artemis" target="_blank">Artemis</a>.</p></div></footer></div></body></html>