<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>크로스 도메인 | Youmekko</title><meta name="description" content="크로스 도메인 - Youme Choi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Youmekko"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Youmekko" type="application/atom+xml">
</head><body><div class="wrap"><header><h1 class="branding"><a href="/" title="Youmekko">Youmekko</a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/youmekko" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about" target="_self">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">크로스 도메인</h1><div class="post-info"><a></a>2018-11-19</div><div class="post-content"><h1 id="크로스-도메인-이슈"><a href="#크로스-도메인-이슈" class="headerlink" title="크로스 도메인 이슈"></a>크로스 도메인 이슈</h1><p>최근 대부분의 웹브라우저는 JS를 이용해 AJAX등을 통해 다른 도메인의 서버의 URL을 호출하여 데이터를 가져오는 경우, 보안 문제를 발생한다.</p>
<p>만약 우리 웹 서비스에서만 사용하기 위해 </p>
<p>다른 서브 도메인을 가진 API함수를 제공하는 API 서버를 구축했는데, 다른 웹서비스에서 이 API 서버에 접근해 마음대로 API를 호출해 사용한다면 문제가 된다.</p>
<p>그래서 Javascript는 동일 출처 정책(Same Origin Policy)라는 정책을 두어 다른 도메인의 서버에 요청하는 것을 보안 문제로 보고 이를 차단한다. 즉, Javascript는 자신이 속한 동일한 도메인 내에서만 서버 요청을 허용하고 처리해주겠다는 것이다. 예를 들어 <a href="http://www.daum.net" target="_blank" rel="noopener">www.daum.net</a> 도메인에서 호출된 AJAX는 <a href="http://www.naver.com" target="_blank" rel="noopener">www.naver.com</a> 의 URL을 ajax로 호출할 수 없다는 의미이다.</p>
<p>이를 다른 말로는 샌드박스라고 한다. 샌드박스는 보호된 영역안에서만 프로그램을 동작시킬 수 있도록 하며, 외부에 의해 영향을 받지 않도록 하는 모델을 말한다…</p>
<p>하지만 하나의 도메인을 가진 웹 서버에서 모든 처리를 하기에는 효율성이나 성능등 여러가지 문제로 각 기능별로 여러 서버를 두는 경우가 많은데 (API서버, WAS서버, 파일 이미지 서버 등) 물리적으로 분리된 서버들이고  다른 용도로 구축된 서버이니 당연히 각각 다른 도메인을 가진 서버들일텐데 서로간에 AJAX 통신을 할 수 없다면…. 불편하겠죠</p>
<p>물리적으로 동일한 서버에서도 여러 도메인을 사용할 수 있는데 이 때도 동일하게 크로스 도메인 이슈는 발생한다… 크로스 도메인은 물리적인 서버나 환경의 이슈가 아닌 도메인 이름 자체의 이슈이다.</p>
<p>밑에 설명할 방식은 서버측에서 크로스 도메인을 허용하여 문제를 해결하는 방식인데, 서버의 수정없이 클라이언트 단에서 해결 하는 방법도 있다. 하지만 100%의 해결은 불가능하다. jsonp, document.domain값 설정, 크롬 브라우저의 특수 옵션 사용등 몇몇 방법이 있으나 범용적인 웹 서비스에서 사용이 어렵거나(사용자가 직접 셋팅해야 한다거나) 그 기능이 제한적인 경우가 대부분이다. 실제 서버에서 해결해주는 것이 표준화된 방법이고 100 해결 가능한 방법이다.</p>
<p>크로스도메인 문제가 발생하면 뜨는 오류는 아래와 같다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XMLHttpRequest cannot load http:&#x2F;&#x2F;www.ozit.co.kr. </span><br><span class="line">No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource.</span><br><span class="line">Origin &#39;http:&#x2F;&#x2F;abc.ozit.co.kr&#39; is therefore not allowed access.</span><br></pre></td></tr></table></figure>

<p>파이어폭스로 보는 경우 한글로 안내가 되는데 “교차 원본 요청 차단 : 동일 출처 정책으로 인해 <a href="http://www.ozit.co.kr에" target="_blank" rel="noopener">http://www.ozit.co.kr에</a> 있는 원격 자원을 읽을 수 없습니다. 자원을 같은 도메인으로 이동시키거나 CORS를 활성화해 해결할 수 있습니다”</p>
<p>같은 도메인을 사용한다면 문제가 해결되겠지만, 그러지 못하는 경우라면 COR를 활성화 시키면 된다.</p>
<p>CORS에 대해 간단히 설명하자면 Cross-Origin Resource Sharing의 약자이며 웹 페이지의 제한된 자원을 외부의 도메인에서의 요청(접근)을 허용해주는 매커니즘이다. CORS는 브라우저 서버간의 Cross-Origin 요청을 허용할지 안할지에 대한 여부를 안전하게 결정하도록 상호 작용을 할 수 있는 방법을 정의한다.</p>
<p>출처 <a href="http://ooz.co.kr/232" target="_blank" rel="noopener">http://ooz.co.kr/232</a></p>
<h3 id="Node-js에서-크로스-도메인"><a href="#Node-js에서-크로스-도메인" class="headerlink" title="Node.js에서 크로스 도메인"></a>Node.js에서 크로스 도메인</h3><p>CORS란 Cross Origin Resource Sharing의 약자로 현재 도메인과 다른 도메인으로 리소스가 요청될 경우를 말한다. </p>
<p>하지만 SPA의 경우는 RESTful API를 기반으로 비동기 네트워크 통신을 하기 떄문에 API서버와 웹 페이지가 다를 수 있다. 이런 경우에 API 서버로 요청을 할 시에 CORS 제한이 걸리게 된다.</p>
<p>Access-Control-Allow-Origin</p>
<p>이를 해결하기 위한 가장 간단한 방법은, 서버(API 서버)의 응답헤더를 변경해주는 것이다. 서버의 헤더중에는 Access-Control-Allow-Origin이라는 프로퍼티가 있는데 CORS를 허용해줄 도메인을 입력하는 곳이다. 이 곳에서 CORS를 허용하기 위해서는 모두를 의미하는 *을 입력하면 된다.</p>
<p>Access-Control-Allow-Origin : *</p>
<p>특정 도메인에게만 허용되길 원한다면 아래처럼 입력하면 된다.</p>
<p>Access-Control-Allow-Origin : <a href="http://A.com" target="_blank" rel="noopener">http://A.com</a>, <a href="http://B.com" target="_blank" rel="noopener">http://B.com</a> </p>
<p>Express에서 CORS를 허용하려면 위에서 언급한 방법처럼 헤더를 직접 변경해주는 방법이 있고, 미들웨어를 사용하는 방법이 있다.</p>
<p>헤더를 직접 변경하는 방법</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.all(<span class="string">'/*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">  res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"X-Requested-With"</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>express의 CORS 미들웨어 적용하는 방법</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// CORS 설정</span></span><br><span class="line">app.use(cors());</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/products/:id'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.json(&#123;<span class="attr">msg</span>: <span class="string">'This is CORS-enabled for all origins!'</span>&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'CORS-enabled web server listening on port 80'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>이처럼 미들 웨어를 사용할 경우 모든 cors 요청을 허용할 시 한줄로 간단하게 추가할 수 있다</p>
<p>출처 <a href="http://guswnsxodlf.github.io/enable-CORS-on-express" target="_blank" rel="noopener">http://guswnsxodlf.github.io/enable-CORS-on-express</a></p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2018/11/26/2018-11-26-Obejct/">prev</a><a class="next" href="/2018/09/19/2018-09-19-git/">next</a></div><div class="copyright"><p>&copy; 2016 - 2020 <a href="https://www.example.org/john-doe" target="_blank" rel="noopener">John Doe</a>.<br>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/Dreyer/hexo-theme-artemis" target="_blank">Artemis</a>.</p></div></footer></div></body></html>